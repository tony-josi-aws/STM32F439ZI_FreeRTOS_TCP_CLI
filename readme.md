# FreeRTOS Kernel + TCP/IP Stack CLI 

This project is a demo integration of the FreeRTOS Kernel and the FreeRTOS + TCP/IP (IPv4 for now) stack with FreeRTOS CLI over UDP/TCP on the STM32F439ZI NUCLEO board.

## Using CubeMX or .ioc file in the project

The Ethernet interface is completely decoupled from the auto generated code provided by the CubeIDE via .ioc file as we are using the NetworkInterface provided Eth init; hence the Ethernet interface is disabled in the .ioc file to disable unnecessary code being generated by the CubeIDE.

The hardware initialization part of the Ethernet is done in the `HAL_ETH_MspInit` and `HAL_ETH_MspDeInit` functions of the app_main.c which are copied versions of the CubeIDE generated code. These functions are called internally by the FreeRTOS + TCP/IP NetworkInterface layer during init.


## `iperf3` bandwidth test results:

``` sh
C:\Users\tonyjosi\Downloads\iperf-3.1.3-win64\iperf-3.1.3-win64>iperf3.exe -c 10.218.244.53 --port 5001 --bytes 40M -V
iperf 3.1.3
CYGWIN_NT-10.0 BLR135CG2096954 2.5.1(0.297/5/3) 2016-04-21 22:14 x86_64
Time: Wed, 29 Mar 2023 04:37:52 GMT
Connecting to host 10.218.244.53, port 5001
      Cookie: BLR135CG2096954.1680064672.134017.40
      TCP MSS: 0 (default)
[  4] local 10.218.244.87 port 2055 connected to 10.218.244.53 port 5001
Starting Test: protocol: TCP, 1 streams, 131072 byte blocks, omitting 0 seconds, 41943040 bytes to send
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-1.01   sec  4.38 MBytes  36.4 Mbits/sec
[  4]   1.01-2.01   sec  4.62 MBytes  38.7 Mbits/sec
[  4]   2.01-3.01   sec  4.88 MBytes  41.0 Mbits/sec
[  4]   3.01-4.01   sec  4.62 MBytes  38.8 Mbits/sec
[  4]   4.01-5.01   sec  4.62 MBytes  38.8 Mbits/sec
[  4]   5.01-6.00   sec  4.62 MBytes  39.0 Mbits/sec
[  4]   6.00-7.00   sec  5.00 MBytes  41.9 Mbits/sec
[  4]   7.00-8.01   sec  4.75 MBytes  39.5 Mbits/sec
[  4]   8.01-8.54   sec  2.50 MBytes  39.7 Mbits/sec
- - - - - - - - - - - - - - - - - - - - - - - - -
Test Complete. Summary Results:
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-8.54   sec  40.0 MBytes  39.3 Mbits/sec                  sender
[  4]   0.00-8.54   sec  39.8 MBytes  39.1 Mbits/sec                  receiver
CPU Utilization: local/sender 1.6% (1.1%u/0.5%s), remote/receiver 0.0% (0.0%u/0.0%s)

iperf Done.

C:\Users\tonyjosi\Downloads\iperf-3.1.3-win64\iperf-3.1.3-win64>iperf3.exe -c 10.218.244.53 --port 5001 --udp --bandwidth 50M --set-mss 1460 --bytes 40M -V
iperf 3.1.3
CYGWIN_NT-10.0 BLR135CG2096954 2.5.1(0.297/5/3) 2016-04-21 22:14 x86_64
Time: Wed, 29 Mar 2023 05:53:03 GMT
Connecting to host 10.218.244.53, port 5001
      Cookie: BLR135CG2096954.1680069183.806947.3e
[  4] local 10.218.244.87 port 51824 connected to 10.218.244.53 port 5001
Starting Test: protocol: UDP, 1 streams, 8192 byte blocks, omitting 0 seconds, 41943040 bytes to send
[ ID] Interval           Transfer     Bandwidth       Total Datagrams
[  4]   0.00-1.00   sec  5.62 MBytes  47.1 Mbits/sec  719
[  4]   1.00-2.02   sec  5.73 MBytes  47.3 Mbits/sec  734
[  4]   2.02-3.00   sec  6.45 MBytes  55.0 Mbits/sec  826
[  4]   3.00-4.00   sec  5.48 MBytes  46.0 Mbits/sec  702
[  4]   4.00-5.00   sec  6.41 MBytes  53.7 Mbits/sec  821
[  4]   5.00-6.00   sec  5.77 MBytes  48.3 Mbits/sec  738
[  4]   6.00-6.75   sec  4.53 MBytes  50.9 Mbits/sec  580
- - - - - - - - - - - - - - - - - - - - - - - - -
Test Complete. Summary Results:
[ ID] Interval           Transfer     Bandwidth       Jitter    Lost/Total Datagrams
[  4]   0.00-6.75   sec  40.0 MBytes  49.7 Mbits/sec  0.000 ms  0/0 (0%)
[  4] Sent 0 datagrams
CPU Utilization: local/sender 4.6% (0.9%u/3.7%s), remote/receiver 0.0% (0.0%u/0.0%s)

iperf Done.

```
